{% extends "templates/base.jinja2" %}
{% block title %}Obj Attrs{% endblock %}
{% block content %}
  {% call h.boxed('%s attrs' % obj['_id']) -%}
    <p>{{obj}}</p>

    <h2>Attrs</h2>
    <ul>
    {% for k, v in obj.attrs.current_pairs.items() %}
      <li>{{ k }}: {{ v }}</li>
    {% endfor %}
    </ul>

    <h2>Unacknowledged changes</h2>
    <ul>
    {% for change in obj.attrs.unacknowledged_changes %}
    <li>
      <code>{{ change }}</code>
      <form action="{{ request.url }}/{{ change['_id'] }}" method="POST"><input type="submit" name="action" value="Accept"></form>
      <form action="{{ request.url }}/{{ change['_id'] }}" method="POST"><input type="submit" name="action" value="Acknowledge"></form>
      <form action="{{ request.url }}/{{ change['_id'] }}" method="POST"><input type="submit" name="action" value="Reject"></form>
    </li>
    {% endfor %}
    </ul>

    <div class="editor">
    <h2>Update value</h2>
    <ul>
      <li>datetime format is YYYY-mm-dd HH:MM:SS. UTC please!</li>
      <li>Lists are ',' separated. Escape character is '\'.</li>
    </ul>
    {{ whh.tags.form(request.url) }}
      <table>
        <tr><td>{{ whh.HTML.label('Key', for='key') }}</td><td><input type="text" name="key"></td></tr>
        <tr><td>{{ whh.HTML.label('Value', for='value') }}</td><td><input type="text" name="value"></td>
          <td>
            <select name="type">
              <option>text</option>
              <option>datetime</option>
              <option>list</option>
              <option>id</option>
            </select>
          </td>
        </tr>
        <tr><td>{{ whh.HTML.label('Note', for='note') }}</td><td><input type="text" name="note"></td></tr>
        <tr><td colspan=2><input type="submit" value="Update"></td></tr>
      </table>
    </form>
    </div>

    <div class="editor">
    <h2>Update File</h2>
    {{ whh.tags.form(request.url, multipart=True) }}
      <table>
        <tr><td>{{ whh.HTML.label('Key', for='key') }}</td><td><input type="text" name="key"></td></tr>
        <tr><td>{{ whh.HTML.label('Value', for='value') }}</td><td><input type="file" name="value"></td></tr>
        <tr><td>{{ whh.HTML.label('Note', for='note') }}</td><td><input type="text" name="note"></td></tr>
        <tr><td colspan=2><input type="submit" value="Update"></td></tr>
      </table>
    </form>
    </div>

    <div class="editor">
    <h2>Delete</h2>
    {{ whh.tags.form(request.url, 'DELETE') }}
      <table>
        <tr><td>{{ whh.HTML.label('Key', for='key') }}</td><td><input type="text" name="key"></td></tr>
        <tr><td>{{ whh.HTML.label('Note', for='note') }}</td><td><input type="text" name="note"></td></tr>
        <tr><td colspan=2><input type="submit" value="Delete"></td></tr>
      </table>
    </form>
    </div>

  {%- endcall %}
{% endblock %}
