#!/srv/webtools/webtools/libcchdoenv/bin/python

from __future__ import with_statement
import sys

import libcchdo as L
import libcchdo.model.datafile
import libcchdo.formats.woce as woce
import libcchdo.formats.summary.woce as sumwoce
import libcchdo.formats.ctd.zip.woce as ctdzipwoce
import libcchdo.formats.ctd.zip.exchange as ctdzipex


def main(argv):
    if len(argv) < 3:
        print "Usage: %s <CTDZIP WOCE> <SUM WOCE>" % argv[0]
        return 1
    
    ctdfiles = L.model.datafile.DataFileCollection()
    sumfile = L.model.datafile.SummaryFile()

    with open(argv[1], 'r') as in_file:
        ctdzipwoce.read(ctdfiles, in_file)

    with open(argv[2], 'r') as in_file:
        sumwoce.read(sumfile, in_file)

    for ctdfile in ctdfiles.files:
        woce.combine(ctdfile, sumfile)

    ctdzipex.write(ctdfiles, sys.stdout)


if __name__ == '__main__':
    sys.exit(main(sys.argv))
